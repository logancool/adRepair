<meta http-equiv="Content-Type" content="text/html; charset=utf-8"
>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="css/style.scss">
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/formvalidation/0.6.1/css/formValidation.min.css">
    <script type="text/javascript" src="js/lib/jszip.js"></script>
    <script type="text/javascript" src="js/lib/FileSaver.js"></script>
    <script type="text/javascript" src="js/repair.js"></script>
    <script type="text/javascript" src="js/helpers.js"></script>
    <script type="text/javascript" src="js/reports.js"></script>
    <script type="text/javascript" src="js/package.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.2/TweenMax.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.3.min.js"
            integrity="sha256-aaODHAgvwQW1bFOGXMeX+pC4PZIPsvn2h1sArYOhgXQ=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"
            integrity="sha256-xNjb53/rY+WmG+4L6tTl9m6PpqknWZvRt0rO1SRnJzw=" crossorigin="anonymous"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/formvalidation/0.6.1/js/formValidation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/formvalidation/0.6.1/js/framework/bootstrap.js"></script>
</head>

<body>

<title>Ad Repair</title>

<div class="container">

    <!-- Top Logo -->
    <img id="logo" src="img/ft_logo.jpg"/>

    <!-- Body -->
    <div class="jumbotron vertical-center">
        <div class-='row-fluid centered text-center'>
            <label class="btn btn-primary center-block" for="inputZips">Browse</label>
            <input id="inputZips" type="file" style="display:none" multiple/>

        </div>
        <div class="row">
            <img id="check" src="img/check.png" class="center-block" style="display:none;"/>

            <div id="errors" class="text-center">
                <div id="mainErrors"></div>
                <div id="errorList"></div>
                <div id="uploadMessage"></div>
                <button id="download" class='center-block' style="display:none" onclick="download()">Download Files
                </button>

            </div>

        </div>


    </div>

    <!-- Footer -->
    <div class="navbar navbar-default navbar-fixed-bottom">
        <div class="container">
            <button class="navbar-btn btn pull-left" id="qBtn" data-toggle="modal" data-target="#qModal"> Questions
            </button>
            <p class="navbar-text pull-right">Â© 2016 - Simplicity Marketing Ltd.
                <a href=" mailto:david.silver@flashtalking.com">david.silver@flashtalking.com</a>
            </p>
        </div>
    </div>

    <!-- Questions Modal Layout -->
    <div class="modal fade" id='qModal' role="dialog">

        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">About the Tool</h4>
                </div>
                <div class="modal-body">
                    The Flashtalking Adfile Repair tool performs a series of checks and corrections on your adfile to
                    ensure
                    that it is compatible with the Flashtalking system.<br><br>
                    <ul>
                        These checks include:
                        <li>Making sure a manifest file exists</li>
                        <li>Detecting if there is a filename mismatch within the manifest</li>
                        <li>Replacing any nonsecure Edge Animate calls</li>
                        <li>Removing any unnecessary subfolders</li>
                        <li>Finding and removing special characters in file name</li>
                    </ul>
                    If no manifest file is detected, the adfile repair tool will create one for you. It will first
                    attempt to extract the dimensions from the filename. If no dimensions are found in the filename, the
                    tool will prompt you to manually input the dimensions for that adfile. All updated files will save
                    out to your specified download folder.

                </div>

            </div>

        </div>
    </div>

    <!-- Manifest Modal Layout -->
    <div class="modal fade" id="manModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h4>Manifest Properties</h4></div>
                <div class="modal-body">
                    No manifest file was detected in your adfile. Please enter the width and height for the adfile
                    below:
                    <form data-toggle="validator" role="form">
                        <div class="form-group">
                            <div class="form-group col-sm-6">
                                <label class="control-label">Width</label>
                                <input type="text" class="form-control" name="manW"
                                       placeholder="728" required>
                            </div>

                            <div class="form-group col-sm-6">
                                <label class="control-label">Height</label>
                                <input type="text" class="form-control" name="manH"
                                       placeholder="90" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>
</div>

</body>
</html>

<script type="text/javascript">

    //call inputFiles when files are loaded
    document.getElementById('inputZips').addEventListener('change', inputFiles, false);

    /**
     * stores the file list and runs the repair
     */
    function inputFiles(input) {

        //store the list of files as fileList
        var fileList = input.target.files;

        //loop through each input file and repair it if it's a zip
        iterateInputList(fileList);

    }

    /**
     * Iterates through list of input files. If file is a zip, repair it (if necessary).
     */
    function iterateInputList(fileList) {

        //for each file in the list
        for (var i = 0; i < fileList.length; i++) {

            //set current file
            var file = fileList[i];

            //confirm is zip before trying to unzip
            if (getFileExt(file.name) == 'zip') {

                //start repair
                repair(file);
            }

        }
    }


    //Display Manifest Modal
    //$('#manModal').modal('show');

</script>