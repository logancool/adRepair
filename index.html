<meta http-equiv="Content-Type" content="text/html; charset=utf-8"
>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="css/style.scss">
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/formvalidation/0.6.1/css/formValidation.min.css">
    <script type="text/javascript" src="js/jszip.js"></script>
    <script type="text/javascript" src="js/FileSaver.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.2/TweenMax.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.3.min.js"
            integrity="sha256-aaODHAgvwQW1bFOGXMeX+pC4PZIPsvn2h1sArYOhgXQ=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"
            integrity="sha256-xNjb53/rY+WmG+4L6tTl9m6PpqknWZvRt0rO1SRnJzw=" crossorigin="anonymous"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/formvalidation/0.6.1/js/formValidation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/formvalidation/0.6.1/js/framework/bootstrap.js"></script>
</head>

<body>

<title>Ad Repair</title>

<div class="container">

    <img id="logo" src="img/ft_logo.jpg"/>
    <div class="jumbotron vertical-center">
        <div class-='row-fluid centered text-center'>
            <label class="btn btn-primary center-block" for="inputFile">Browse</label>
            <input id="inputFile" type="file" style="display:none" multiple onchange="inputFiles()"/>

        </div>
        <div class="row">
            <img id="check" src="img/check.png" class="center-block" style="display:none;"/>

            <div id="errors" class="text-center">
                <div id="mainErrors"></div>
                <div id="errorList"></div>
                <div id="uploadMessage"></div>
                <button id="download" class='center-block' style="display:none" onclick="download()">Download Files
                </button>

            </div>

        </div>


    </div>

    <div class="navbar navbar-default navbar-fixed-bottom">
        <div class="container">
            <button class="navbar-btn btn pull-left" id="qBtn" data-toggle="modal" data-target="#qModal"> Questions
            </button>
            <p class="navbar-text pull-right">Â© 2016 - Simplicity Marketing Ltd.
                <a href=" mailto:david.silver@flashtalking.com">david.silver@flashtalking.com</a>
            </p>
        </div>
    </div>


    <div class="modal fade" id='qModal' role="dialog">

        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">About the Tool</h4>
                </div>
                <div class="modal-body">
                    The Flashtalking Adfile Repair tool performs a series of checks and corrections on your adfile to
                    ensure
                    that it is compatible with the Flashtalking system.<br><br>
                    <ul>
                        These checks include:
                        <li>Making sure a manifest file exists</li>
                        <li>Detecting if there is a filename mismatch within the manifest</li>
                        <li>Replacing any nonsecure Edge Animate calls</li>
                        <li>Removing any unnecessary subfolders</li>
                        <li>Finding and removing special characters in file name</li>
                    </ul>
                    If no manifest file is detected, the adfile repair tool will create one for you. It will first
                    attempt to extract the dimensions from the filename. If no dimensions are found in the filename, the
                    tool will prompt you to manually input the dimensions for that adfile. All updated files will save
                    out to your specified download folder.

                </div>

            </div>

        </div>
    </div>


    <div class="modal fade" id="manModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h4>Manifest Properties</h4></div>
                <div class="modal-body">
                    No manifest file was detected in your adfile. Please enter the width and height for the adfile
                    below:
                    <form data-toggle="validator" role="form">
                        <div class="form-group">
                            <div class="form-group col-sm-6">
                                <label class="control-label">Width</label>
                                <input type="text" class="form-control" name="manW"
                                       placeholder="728" required>
                            </div>

                            <div class="form-group col-sm-6">
                                <label class="control-label">Height</label>
                                <input type="text" class="form-control" name="manH"
                                       placeholder="90" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>
    <script>
        //returns true if the value is in the array
        function isIn(value, array) {
            if (array.indexOf(value) != -1) {
                return true;
            }
            else {
                return false;
            }
        }

        //returns if the width or height (dim) is a common dimension (value)
        function isCommonDim(dim, value) {
            if (dim == 'w'){
                var commonW = [1, 88, 120, 120, 125, 160, 180, 234, 240, 250, 300, 336, 468, 728];
                if (isIn(value, commonW)) {
                    return true;
                }
                else {
                    return false;
                }
            }
            else {
                var commonH = [1, 31, 60, 90, 125, 150, 240, 250, 280, 400, 600];
                if (isIn(value, commonH)) {
                    return true;
                }
                else {
                    return false;
                }
            }
        }

        $('#manModal').modal('show');
        $('#manModal').formValidation({
                    framework: 'bootstrap',
                    icon: {
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',

                        validating: 'glyphicon glyphicon-refresh'
                    },
                    addOns: {
                        mandatoryIcon: {
                            icon: 'glyphicon giyphicon-warning-sign',
                            message: 'This size is uncommon'
                        }
                    },
                    fields: {
                        manW: {
                            validators: {
                                notEmpty: {
                                    message: 'A width is required'
                                },
                                between: {
                                    min: 1,
                                    max: 9999,
                                    message: 'The height must be a number between 1 and 9999'
                                },
                                integer: {
                                    min: 0,
                                    message: 'The value is not an integer',
                                    // The default separators
                                    thousandsSeparator: '',
                                    decimalSeparator: '.'
                                }
                            }
                        },
                        manH: {
                            validators: {
                                notEmpty: {
                                    message: 'A height is required'
                                },
                                between: {
                                    min: 1,
                                    max: 9999,
                                    message: 'The height must be a number between 1 and 9999'
                                },
                                integer: {
                                    min: 0,
                                    message: 'The value is not an integer',
                                    // The default separators
                                    thousandsSeparator: '',
                                    decimalSeparator: '.'
                                }
                            }
                        }
                    }
                })

                // This event will be triggered when the field passes given validator
                .on('success.validator.fv', function (e, data) {

                    W = 0; // the width element index
                    H = 1; // the height element index

                    //The live value of the users input
                    inputW = parseInt(data.element[0].value);

                    console.log(inputW + " : " + isCommonDim(inputW));
                    //check if warning for manW field
                    if (data.field === 'manW'){
                            if (!(isCommonDim('w', inputW))){
                                // The userName field passes the remote validator
                                data.element                    // Get the field element
                                        .closest('.form-group')     // Get the field parent

                                        // Add has-warning class
                                        .removeClass('has-success')
                                        .addClass('has-warning')
                            }
                            //reset to green
                            else {
                                // The userName field passes the remote validator
                                data.element                    // Get the field element
                                        .closest('.form-group')     // Get the field parent

                                        // Add has-warning class
                                        .removeClass('has-warning')
                                        .addClass('has-success')
                            }
                    }
                })
                // This event will be triggered when the field doesn't pass given validator
                .on('err.validator.fv', function (e, data) {
                    // We need to remove has-warning class
                    // when the field doesn't pass any validator
                    if (data.field === 'manW') {
                        data.element
                                .closest('.form-group')
                                .removeClass('has-warning')
                                .addClass('has-success')
                    }
                })

    </script>
    <script type="text/javascript">
        // Get the modal
        var modal = document.getElementById('qModal');

        // Get the button that opens the modal
        var btn = document.getElementById("qBtn");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks on the button, open the modal
        btn.onclick = function () {
            modal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        var fileName = "";
        var mainHTML = "";
        var manifest;
        var manifestFile = "";
        var htmlText = "";
        var manifestText = "";
        var htmlWrite = false;
        var manifestWrite = false;
        var problems = [];
        var fileCount = 0;
        var manifestFound = false;
        var flaFound = false;
        var checkAnimated = false;
        var noManifestFound = false;
        var fileNameMismatch = false;
        var nonSecureCalls = false;
        var htmlFile = "";
        var newManifest = "";
        var macosx = false;
        var subfolderName = "";
        var subfolder = false;
        var subfolderIndex = 0;
        var macIndex = 0;
        var checkMac = 0;
        var orgHTML = "";
        var specialCharacters = false;
        var apiFound = false;
        var files = [];
        var f = 0;
        var zipArrayContent = [];
        var zipArrayFilename = [];
        var generate = false;
        var whiteSpace = false;
        var apiArray = [];
        var nonApiArray = [];

        document.getElementById("check").style.opacity = 0;

        function resetVars() {
            fileNameMismatch = false;
            nonSecureCalls = false;
            subfolder = false;
            specialCharacters = false;
            generate = false;
            whiteSpace = false;
            f = 0;
            console.log("F: " + f)
            files = [];
            zipArrayContent = [];
            zipArrayFilename = [];

            //Clear problems array
            problems = [];
            apiArray = [];
            nonApiArray = [];
        }

        function init() {
            fileName = "";
            mainHTML = "";
            manifest;
            manifestFile = "";
            htmlText = "";
            manifestText = "";
            htmlWrite = false;
            subfolder = false;
            manifestWrite = false;
            files = [];
            fileCount = 0;
            macosx = false;
            subfolderName = "";
            subfolderIndex = 0;
            macIndex = 0;
            checkMac = 0;
            orgHTML = "";
            noManifestFound = false;
            apiFound = false;
            subfolderError = false;
            manifestFound = false;
            whiteSpcae = false;
            flaFound = false;


            document.getElementById("errorList").innerHTML = "";
            document.getElementById("mainErrors").innerHTML = "";
            document.getElementById("uploadMessage").innerHTML = "";
            document.getElementById("check").style.opacity = 0;
            document.getElementById("errorList").style.opacity = 0;
            document.getElementById("mainErrors").style.opacity = 0;
            document.getElementById("uploadMessage").style.opacity = 0;
            document.getElementById("input1").value = "";
            document.getElementById("input2").value = "";
            document.getElementById("download").style.display = "none";
            document.getElementById("download").style.opacity = 0;
            TweenLite.to(check, 0, {
                alpha: 0
            });
            checkAnimated = false;
            htmlFile = ""
            newManifest = ""
        }

        function inputFiles() {

            var inputFile = document.getElementById("inputFile");

            console.log("F: " + f)

            if (generate) {
                console.log("RESET")
                resetVars();
            }
            var file = inputFile.files[f];
            var filename = file.name;
            inputFile_Changed(file, filename);
        }

        function inputFile_Changed(file, filename) {
            var zipFileToLoad = file;
            files = new Array();

            var fileReader = new FileReader();

            fileName = filename.substr(filename.lastIndexOf("\\") + 1, filename.length);
            console.log("fileName: " + fileName)

            fileReader.onload = function (fileLoadedEvent) {
                init();
                fileName = filename;

                var zipFileLoaded = new JSZip(fileLoadedEvent.target.result);
                var ulFilesContained = document.getElementById("ulFilesContained");
                for (var nameOfFileContainedInZipFile in zipFileLoaded.files) {
                    var fileContainedInZipFile = zipFileLoaded.files[nameOfFileContainedInZipFile];
                    console.log(fileContainedInZipFile.name)

                    //Push each file into an array called files
                    files.push(fileContainedInZipFile);

                    //GET FILENAME
                    var slash = fileContainedInZipFile.name.lastIndexOf("/");
                    var file_name = fileContainedInZipFile.name.substring(slash + 1);

                    //FIND MANFIEST FILE
                    if (file_name == "manifest.js") {
                        manifestFound = true;
                        manifest = fileCount;
                    }
                    //Check for FLA
                    var fla = fileContainedInZipFile.name.lastIndexOf(".fla");
                    if (fla > -1) {
                        flaFound = true;
                    }
                    //Check if MACOSX folder exists
                    // if(fileContainedInZipFile.name.substr(0,8) == "__MACOSX"){
                    //     macosx = true;
                    //     macIndex = fileCount;
                    // }
                    if (fileContainedInZipFile.name.substr(slash - 8, 8) == "__MACOSX" && macosx != true) {
                        console.log("MACOSX FOUND")
                        macosx = true;
                        subfolderError = true;
                        macIndex = slash - 8;
                    }
                    //CHECK MAIN HTML TO REPLACE POTENTIAL ANIMATE CALL
                    if (fileContainedInZipFile.name.split('.').pop() == "html") {
                        if (fileContainedInZipFile.name.substr(slash - 8, 8) != "__MACOSX" && fileContainedInZipFile.name.substr(macIndex, 8) != "__MACOSX") {
                            htmlText = fileContainedInZipFile.asText();
                            mainHTML = fileContainedInZipFile.name;
                            orgHTML = mainHTML;
                        }
                        // checkMac = fileContainedInZipFile.name.lastIndexOf("__MACOSX");
                        // if(checkMac<=-1){

                        //  }
                        var slash = mainHTML.lastIndexOf("/");
                        if (slash > -1) {
                            subfolder = true;
                            subfolderError = true;
                            if (fileContainedInZipFile.name.substr(macIndex, 8) != "__MACOSX") {
                                subfolderName = mainHTML.substring(0, slash);
                            }
                            mainHTML = mainHTML.substring(slash + 1, mainHTML.length);
                            orgHTML = mainHTML;
                        }

                        console.log("MAIN HTML: " + mainHTML)
                        //CHECK HTML CODE FOR API
                        var api = htmlText.lastIndexOf("html5API.js")
                        if (api > -1) {
                            apiFound = true;
                        }
                        //CHECK IF EDGE ANIMATE CALL IS SECURE
                        var animate = htmlText.lastIndexOf("http://animate.adobe.com/");
                        if (animate > -1) {
                            nonSecureCalls = true;
                            end = htmlText.lastIndexOf("</html>")
                            var animateReplace = "https://animate.adobe.com/"
                            htmlText = [htmlText.slice(0, animate - 1), '"' + animateReplace, htmlText.slice(animate + animateReplace.length - 1, end + 7)].join('');
                            htmlWrite = true;
                        }
                    }

                    fileCount++;
                }


                //REMOVE ANY SPECIAL CHARACTERS FROM MAIN HTML
                var str = mainHTML.substr(0, mainHTML.length - 5);
                var tmp = str;
                str = str.replace(/ /g, "_");
                if (str != tmp) {
                    whiteSpace = true;
                }
                tmp = str;
                str = str.replace(/[^a-zA-Z_0-9-]/g, "");
                if (str != tmp) {
                    specialCharacters = true;
                }
                mainHTML = str + ".html"

                //REMOVE ANY SPECIAL CHARACTERS FROM FILE NAME
                var fileNameOrg = fileName;
                var str = fileName.substr(0, fileName.length - 4);
                var tmp = str;
                str = str.replace(/ /g, "_");
                if (str != tmp) {
                    whiteSpace = true;
                }
                tmp = str;
                str = str.replace(/[^a-zA-Z_0-9-]/g, "");
                if (str != tmp) {
                    specialCharacters = true;
                }
                fileName = str + ".zip"

                if (apiFound) {
                    apiArray.push(fileName);
                } else {
                    nonApiArray.push(filename);
                }


                //FIND SUBFOLDER INDEX
                if (subfolder) {
                    for (var f = 0; f < files.length; f++) {
                        if (files[f].name == subfolderName + "/") {
                            subfolderIndex = f;
                            break;
                        }
                    }
                }
                //CHECK MANIFEST TO SEE IF NAME MATCHES HTML FILENAME
                //-------------------------------------------------------
                var slash = mainHTML.lastIndexOf("/");
                htmlFile = mainHTML.substring(slash + 1);

                console.log("HTML FILE: " + htmlFile)

                if (manifestFound) {
                    manifestText = files[manifest].asText();
                    manifestFile = files[manifest].name;
                    var filename_m = manifestText.lastIndexOf("filename");
                    var html_m = manifestText.lastIndexOf(".html");
                    var end_m = manifestText.lastIndexOf("})")
                    manifestWrite = true;

                    var quotes = [];

                    for (var q = 0; q <= manifestText.length; q++) {
                        if (manifestText[q] === '"') quotes.push(q);
                        if (quotes.length == 3) {
                            break;
                        }
                    }
                    console.log("MANIFEST FILENAME: " + manifestText.substr(quotes[2] + 1, (html_m - quotes[2]) + 4))
                    if (manifestText.substr(quotes[2] + 1, (html_m - quotes[2]) + 4) != htmlFile) {
                        manifestText = [manifestText.slice(0, quotes[2] + 1), htmlFile, manifestText.slice(html_m + 5, end_m + 3)].join('');
                        fileNameMismatch = true;
                    }
                    makeZip();

                }

                //IF NO MANIFEST EXISTS CREATE ONE
                var width = "";
                var height = "";

                var indices = [];
                var indices2 = [];

                for (var d = 0; d < fileName.length; d++) {
                    if (fileName[d] === "x") indices.push(d);
                }

                for (var c = 0; c < mainHTML.length; c++) {
                    if (mainHTML[c] === "x") indices2.push(c);
                }
                if (manifestFound != true) {
                    noManifestFound = true;
                    //CHECK MAIN FILE NAME FOR DIMENSIONS
                    for (x = 0; x < indices.length; x++) {
                        if (Number(fileName.substr(indices[x] - 3, 3) % 1) == 0) {
                            width = fileName.substr(indices[x] - 3, 3);
                        }
                        //Check 2 or 3 characters past the x to determine the height
                        if (Number(fileName.substr(indices[x] + 1, 3) % 1) == 0 && fileName[indices[x] + 3] != ".") {
                            height = fileName.substr(indices[x] + 1, 3);
                            fileName[indices[x] + 3]
                        } else if (Number(fileName.substr(indices[x] + 1, 2) % 1) == 0) {
                            height = fileName.substr(indices[x] + 1, 2);
                        }
                    }
                    //CHECK MAIN HTML FILE NAME FOR DIMENSIONS
                    for (var y = 0; y < indices2.length; y++) {
                        if (Number(mainHTML.substr(indices2[y] - 3, 3) % 1) == 0 && width == "") {
                            width = mainHTML.substr(indices2[y] - 3, 3);
                        }
                        //Check 2 or 3 characters past the x to determine the height
                        if (height == "") {
                            if (Number(mainHTML.substr(indices2[y] + 1, 3) % 1) == 0 && mainHTML[indices2[y] + 3] != ".") {
                                height = mainHTML.substr(indices2[y] + 1, 3);
                            } else if (Number(mainHTML.substr(indices2[y] + 1, 2) % 1) == 0) {
                                height = mainHTML.substr(indices2[y] + 1, 2);
                            }
                        }
                    }
                    if (width == "" && height == "") {
                        document.getElementById("background").style.display = "block";
                        document.getElementById("manifestDialog").innerHTML = "No manifest file was detected in your adfile. Please enter the width and height for the adfile below:<br><br>" + fileName;
                        console.log("file name for manifest: " + fileName);
                        $("#dialog").dialog("open");
                    }
                    newManifest = 'FT.manifest({\n"filename": "' + htmlFile + '",\n"width": ' + width + ',\n"height": ' + height + ',\n"clickTagCount": 1\n});'
                }

                if (width != "" && height != "") {
                    makeZip();
                }
            }


            fileReader.readAsArrayBuffer(zipFileToLoad);


        }


        function makeZip() {

            var zip = new JSZip();

            //SEARCH THROUGH FILES TO SEE IF SUBFOLDER EXISTS
            // var count = 0;
            // for (a = 0; a < files.length; a++) {
            //     if (files[a].name.substring(0, files[0].name.length) == files[0].name) {
            //         count++;
            //     }
            //     if (count == files.length) {
            //         subfolder = true;
            //         subfolderError = true;
            //     }
            // }

            if (subfolder != true) {
                for (i = 0; i < files.length; i++) {
                    var fla = files[i].name.lastIndexOf(".fla");
                    if (manifestWrite == true && files[i].name == manifestFile) {
                        zip.file(files[i].name, manifestText);
                    } else {
                        if (files[i].name.substring(0, 8) != "__MACOSX" && files[i].name != orgHTML && files[i].name.substr(files[i].name.length - 4) != "html" && fla <= -1) {
                            zip.file(files[i].name, files[i].asUint8Array());
                        }
                    }
                    if (manifestFound != true) {
                        zip.file("manifest.js", newManifest);
                    }
                }
            } else {
                console.log("SUBFOLDER NAME: " + subfolderName)
                for (i = 0; i < files.length; i++) {
                    var fla = files[i].name.lastIndexOf(".fla");
                    if (manifestWrite == true && files[i].name == manifestFile) {
                        zip.file(files[i].name.substring(subfolderName.length + 1), manifestText);
                    } else {
                        if (files[i].name.substr(macIndex, 8) != "__MACOSX" && files[i].name.substr(0, 8) != "__MACOSX" && files[i].name != orgHTML && files[i].name.substr(files[i].name.length - 4) != "html" && files[i].name != subfolderName + "/" && fla <= -1) {
                            zip.file(files[i].name.substring(subfolderName.length + 1), files[i].asUint8Array());
                        }

                    }
                    if (manifestFound != true) {
                        zip.file("manifest.js", newManifest);
                    }
                }
            }

            zip.file(mainHTML, htmlText);

            var content = zip.generate({
                type: "blob"
            });

            console.log("FILENAME: " + fileName)
            // see FileSaver.js

            zipArrayContent.push(content);
            zipArrayFilename.push(fileName);
            //saveAs(content, fileName);


            f++;
            var inputFile = document.getElementById("inputFile");
            if (f < inputFile.files.length) {
                inputFiles();
            }
            checkZip();

        }

        function checkZip() {
            var inputFile = document.getElementById("inputFile");
            if (inputFile.files.length == zipArrayFilename.length && generate != true) {
                generateErrors();
                generate = true;

            }

        }

        function download() {
            var inputFile = document.getElementById("inputFile");
            for (var i = 0; i < inputFile.files.length; i++) {
                saveAs(zipArrayContent[i], zipArrayFilename[i]);
            }
        }


        function generateErrors() {

            var errorList = document.getElementById("errorList");
            var mainErrors = document.getElementById("mainErrors");
            var check = document.getElementById("check");
            var uploadMessage = document.getElementById("uploadMessage");
            var downloadButton = document.getElementById("download");

            if (subfolder) {
                problems.push("Subfolders detected and removed");
            }
            if (specialCharacters) {
                problems.push("Special characters found and removed");
            }
            if (whiteSpace) {
                problems.push("Whitespaces found and removed")
            }
            if (noManifestFound) {
                problems.push("No manifest file found");
            }
            if (fileNameMismatch) {
                problems.push("Filename mismatch found");
            }
            if (nonSecureCalls) {
                problems.push("Nonsecure Edge Animate call detected and replaced")
            }
            if (flaFound) {
                problems.push("FLA file found and removed");
            }

            if (apiArray.length >= 1 && f > apiArray.length) {
                uploadMessage.innerHTML = "Upload the following files to the <b>Base Files</b> tab:<br><br>";
                for (var aa = 0; aa < apiArray.length; aa++) {
                    uploadMessage.innerHTML += '<span style="font-size:13px">' + apiArray[aa] + '</span><br>';
                }
                uploadMessage.innerHTML += "<br>Upload the following files to the <b>Standard Ads</b> tab:<br><br>";
                for (var aa = 0; aa < nonApiArray.length; aa++) {
                    uploadMessage.innerHTML += '<span style="font-size:13px">' + nonApiArray[aa] + '</span><br>';
                }
                uploadMessage.innerHTML += "<br>"
            }
            if (apiArray.length > 1 && f == apiArray.length) {
                uploadMessage.innerHTML = "Please upload your files to the <b>Base Files</b> tab";
            }
            if (apiArray.length == 1 && f == 1) {
                uploadMessage.innerHTML = "Please upload your file to the <b>Base Files</b> tab";
            }
            if (apiArray.length < 1) {
                if (f > 1) {
                    uploadMessage.innerHTML = "Please upload your files to the <b>Standard Ads</b> tab";
                } else {
                    uploadMessage.innerHTML = "Please upload your file to the <b>Standard Ads</b> tab";
                }
            }


            TweenLite.to(check, 1, {
                alpha: 1,
                ease: Power2.easeOut
            });
            TweenLite.to(check, .8, {
                scaleX: 0,
                ease: Power4.easeIn,
                delay: .2
            });
            TweenLite.to(check, .5, {
                scaleX: 1,
                ease: Power4.easeOut,
                delay: 1
            });
            TweenLite.to(mainErrors, .5, {
                alpha: 1,
                delay: 1
            });
            TweenLite.to(errorList, .5, {
                alpha: 1,
                delay: 1.5
            });
            TweenLite.to(uploadMessage, .5, {
                alpha: 1,
                delay: 1.8
            });
            if (problems.length > 0) {
                downloadButton.style.display = "block";
                TweenLite.to(downloadButton, .5, {
                    alpha: 1,
                    delay: 2
                });
            }

            checkAnimated = true;

            if (problems.length == 1) {
                mainErrors.innerHTML += problems.length + " issue detected and resolved<br><b>";
            }
            if (problems.length > 1) {
                mainErrors.innerHTML += problems.length + " issues detected and resolved<br><b>";
            }
            if (problems.length <= 0) {
                mainErrors.innerHTML += "No issues detected";
            }
            for (e = 0; e < problems.length; e++) {
                errorList.innerHTML += problems[e] + "<br>";
            }
        }

        var check = document.getElementById("check");
        check.addEventListener("mouseenter", function () {
            if (checkAnimated) {
                TweenLite.to(check, .5, {
                    scaleX: 0,
                    ease: Power4.easeIn
                });
                TweenLite.to(check, .5, {
                    scaleX: 1,
                    ease: Power4.easeOut,
                    delay: .5
                });
            }
        })

        //DUAL INPUT PROMPT FOR MANIFEST WIDTH AND HEIGHT
        document.getElementById("input1").value = "";
        document.getElementById("input2").value = "";
        $("#dialog").dialog({
            autoOpen: false,
            buttons: [{
                text: "Ok",
                click: function () {
                    width = document.getElementById("input1").value;
                    height = document.getElementById("input2").value;
                    if (width != "" && height != "") {
                        newManifest = 'FT.manifest({\n"filename": "' + htmlFile + '",\n"width": ' + width + ',\n"height": ' + height + ',\n"clickTagCount": 1\n});'
                        makeZip();
                        document.getElementById("background").style.display = "none";

                        $(this).dialog("close");
                    } else {
                        alert("Plaese enter a width and height");
                    }
                }
            },]
        });

        //QUESTION ROLLOVER
        //document.getElementById("question").addEventListener("mouseenter", function () {
        //document.getElementById("help").style.display = "block";
        //})
        //document.getElementById("question").addEventListener("mouseleave", function () {
        //document.getElementById("help").style.display = "none";
        //})
    </script>
</body>

</html>